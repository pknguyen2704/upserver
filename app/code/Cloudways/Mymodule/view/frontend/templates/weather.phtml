<div id="weather"></div>

<script>
    const apiKey = "<?php echo $block->getApiKey(); ?>";
    const city = "<?php echo $block->getCity(); ?>";
    const lang = "<?php echo $block->getLang(); ?>";

    async function getForecast() {
        const response = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=${lang}`
        );
        const data = await response.json();
        displayForecast(data);
    }

    function displayForecast(data) {
        const forecastDiv = document.getElementById("weather");
        forecastDiv.innerHTML = "<h2>Dự báo thời tiết trong 4 ngày</h2>";

        const dailyData = {};
        data.list.forEach((item) => {
            const date = new Date(item.dt * 1000).toLocaleDateString("vi-VN", {
                weekday: "long",
            });
            if (!dailyData[date]) {
                dailyData[date] = item;
            }
        });

        const days = Object.keys(dailyData).slice(0, 8); // 4 ngày
        days.forEach((day) => {
            const dayData = dailyData[day];
            const html = `
                <h3>${day}</h3>
                <p><strong>Thời tiết:</strong> ${dayData.weather[0].main} (${dayData.weather[0].description})</p>
                <p>
                    <img src="https://openweathermap.org/img/wn/${dayData.weather[0].icon}@2x.png" alt="Weather Icon">
                </p> 
                <p><strong>Nhiệt độ:</strong> ${dayData.main.temp}°C</p>
                <p><strong>Độ ẩm:</strong> ${dayData.main.humidity}%</p>
            `;
            forecastDiv.innerHTML += html;
        });
    }

    getForecast();
</script>
